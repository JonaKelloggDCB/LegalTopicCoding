---
title: "LegalTopicAnalysis"
author: "Jonathan Kellogg"
date: "2026-01-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

Welcome to my coding on the analysis for the Frankenstein's bill project. In this section I outline the code I used for the initial exploratory research and graphs 

#Load Data
```{r}
df_all <- read.csv("/Users/jonathankellogg/Desktop/df_top10.csv")

```
---

# Check hiddenness_textual against divergence

```{r}
library(stargazer)
library(ggplot2)
library(hexbin)

p_hiddenness <- ggplot(df_all, aes(x = hiddenness_textual, y = divergence_vs_title)) +
  geom_hex(bins = 50) +
  scale_fill_viridis_c(name = "Observations") +
  geom_smooth(
    method = "lm",
    color = "black",
    se = FALSE,
    linewidth = 0.8
  ) +
  labs(
    x = "Textual Hiddenness",
    y = "Textual Divergence from Title",
    title = "Textual Hiddenness and Divergence from Legislative Titles"
  ) +
  theme_minimal(base_size = 12)

sum(df_all$section_label != df_all$title_label)

ggsave(
  filename = "combocount.pdf",
  plot = p_hiddenness,
  width = 6.5,
  height = 5,
  units = "in"
)

#Regression
library(stargazer)

model_hiddenness <- lm(
  divergence_vs_title ~ hiddenness_textual,
  data = df_all
)

stargazer(
  model_hiddenness,
  type = "latex",          # use "latex" or "html" if needed
  title = "Textual Hiddenness and Divergence from Legislative Titles",
  dep.var.labels = "Textual Divergence from Title",
  covariate.labels = "Textual Hiddenness",
  omit.stat = c("f", "ser"),
  digits = 3
)

```

---

#Disaggregation by section


## Set level

```{r}
df_all$section_label <- relevel(
  factor(df_all$section_label),
  ref = "immigration"
)

df_all$title_label <- relevel(
  factor(df_all$title_label),
  ref = "immigration"
)
```

## Hiddenness by title section
```{r}
p_box_hiddenness_title <- ggplot(
  df_all,
  aes(x = title_label, y = hiddenness_textual)
) +
  geom_boxplot(outlier.alpha = 0.1) +
  labs(
    x = "Title Subject",
    y = "Textual Hiddenness",
    title = "Textual Hiddenness by Legislative Title Label"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

p_box_hiddenness_title

```

# Hiddenness by section title

```{r}
p_box_hiddenness_section <- ggplot(
  df_all,
  aes(x = section_label, y = hiddenness_textual)
) +
  geom_boxplot(outlier.alpha = 0.1) +
  labs(
    x = "Section Label",
    y = "Textual Hiddenness",
    title = "Textual Hiddenness by Legislative Section Label"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

p_box_hiddenness_section


```

## Divergence by title label
```{r}

p_box_divergence_title <- ggplot(
  df_all,
  aes(x = title_label, y = divergence_vs_title)
) +
  geom_boxplot(outlier.alpha = 0.1) +
  labs(
    x = "Title Label",
    y = "Textual Divergence from Title",
    title = "Textual Divergence by Legislative Title Label"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

p_box_divergence_title


```

## Divergence by section label

```{r}
p_box_divergence_section <- ggplot(
  df_all,
  aes(x = section_label, y = divergence_vs_title)
) +
  geom_boxplot(outlier.alpha = 0.1) +
  labs(
    x = "Section Label",
    y = "Textual Divergence from Title",
    title = "Textual Divergence by Legislative Section Label"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

p_box_divergence_section

```


## Save the graphs

```{r}
ggsave(
  "box_hiddenness_title.pdf",
  plot = p_box_hiddenness_title,
  width = 6,
  height = 4,
  units = "in"
)

ggsave(
  "box_hiddenness_section.pdf",
  plot = p_box_hiddenness_section,
  width = 6,
  height = 4,
  units = "in"
)

ggsave(
  "box_divergence_title.pdf",
  plot = p_box_divergence_title,
  width = 6,
  height = 4,
  units = "in"
)

ggsave(
  "box_divergence_section.pdf",
  plot = p_box_divergence_section,
  width = 6,
  height = 4,
  units = "in"
)


```

# Country level

## Hiddenness by country
```{r}


p_box_hiddenness_country <- ggplot(
  df_all,
  aes(x = country, y = hiddenness_textual)
) +
  geom_boxplot(outlier.alpha = 0.1) +
  labs(
    x = "Country",
    y = "Textual Hiddenness",
    title = "Textual Hiddenness by Country"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

p_box_hiddenness_country

```

#Divergence by country 
```{r}
p_box_divergence_country <- ggplot(
  df_all,
  aes(x = country, y = divergence_vs_title)
) +
  geom_boxplot(outlier.alpha = 0.1) +
  labs(
    x = "Country",
    y = "Textual Divergence from Title",
    title = "Textual Divergence by Country"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.minor = element_blank()
  )

p_box_divergence_country

```

## Save plots
```{r}
ggsave(
  "box_hiddenness_country.pdf",
  plot = p_box_hiddenness_country,
  width = 6,
  height = 4,
  units = "in"
)

ggsave(
  "box_divergence_country.pdf",
  plot = p_box_divergence_country,
  width = 6,
  height = 4,
  units = "in"
)

```

---

#Heatmap

```{r}
library(dplyr)
library(ggplot2)
plot2 <- ggplot(combo_counts, aes(
  x = title_label,
  y = section_label,
  fill = n
)) +
  geom_tile() +
  scale_fill_viridis_c(name = "Observations") +
  labs(
    x = "Title Subject",
    y = "Section Subject",
    title = "Sectionâ€“Title Subject Combinations (Excluding None)"
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

plot2

ggsave(
  "heathmap.pdf",
  plot = plot2,
  width = 6,
  height = 4,
  units = "in"
)
```

# Time

```{r}
library(dplyr)
library(lubridate)

#Aggregate years
df_all <- df_all %>%
  mutate(
    year_combined = coalesce(
      year,
      year(texte_date_publi),
      year(Date_publication)
    )
  )

#filter
df_all <- df_all %>%
  filter(
    year_combined != 2999,
    year_combined >= 1945
  )
```

# Plot
```{r}
df_year_country <- df_all %>%
  filter(!is.na(year_combined)) %>%
  group_by(country, year_combined) %>%
  summarise(
    mean_hiddenness = mean(hiddenness_textual, na.rm = TRUE),
    mean_divergence = mean(divergence_vs_title, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )


```

## Plot hiddenness
```{r}
p_hiddenness_time <- ggplot(
  df_year_country,
  aes(x = year_combined, y = mean_hiddenness, color = country)
) +
  geom_line(linewidth = 0.9) +
  labs(
    x = "Year",
    y = "Mean Textual Hiddenness",
    title = "Textual Hiddenness over Time by Country"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )

p_hiddenness_time


```

##Plot divergence
```{r}
p_divergence_time <- ggplot(
  df_year_country,
  aes(x = year_combined, y = mean_divergence, color = country)
) +
  geom_line(linewidth = 0.9) +
  labs(
    x = "Year",
    y = "Mean Textual Divergence from Title",
    title = "Textual Divergence over Time by Country"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )

p_divergence_time


```

## Save plots
```{r}
ggsave(
  "hiddenness_over_time_by_country.pdf",
  plot = p_hiddenness_time,
  width = 7,
  height = 4.5,
  units = "in"
)

ggsave(
  "divergence_over_time_by_country.pdf",
  plot = p_divergence_time,
  width = 7,
  height = 4.5,
  units = "in"
)


```

# Regression plot

## Topic and hiddenness
```{r}
library(stargazer)

# Section only
m_hidden_section <- lm(
  hiddenness_textual ~ section_label,
  data = df_all
)

# Title only
m_hidden_title <- lm(
  hiddenness_textual ~ title_label,
  data = df_all
)

# Section + Title
m_hidden_both <- lm(
  hiddenness_textual ~ section_label + title_label,
  data = df_all
)


stargazer(
  m_hidden_section,
  m_hidden_title,
  m_hidden_both,
  type = "latex",
  title = "Textual Hiddenness by Section and Title Subject",
  label = "tab:hiddenness-subjects",
  dep.var.labels = "Textual Hiddenness",
  column.labels = c(
    "Section Only",
    "Title Only",
    "Section + Title"
  ),
  align = TRUE,
  no.space = TRUE,
  digits = 3,
  omit.stat = c("f", "ser"),
  notes = c(
    "Reference category for all subject indicators is ``none''.",
    "Standard errors in parentheses."
  )
)

```

##T Topic and extual Difference

```{r}


stargazer(
  m_diff_section,
  m_diff_title,
  m_diff_both,
  type = "latex",
  title = "Textual Difference by Policy Subject",
  label = "tab:textual-difference-subjects",
  dep.var.labels = "Textual Difference",
  column.labels = c(
    "Section Only",
    "Title Only",
    "Section + Title"
  ),
  align = TRUE,
  no.space = TRUE,
  digits = 3,
  omit.stat = c("f", "ser"),
  notes = c(
    "Reference category for all subject indicators is Immigration.",
    "Standard errors in parentheses."
  )
)

```


## Regression by country
```{r}
m_hiddenness_country <- lm(
  hiddenness_textual ~ country,
  data = df_all
)

m_difference_country <- lm(
  textual_difference ~ country,
  data = df_all
)

stargazer(
  m_hiddenness_country,
  m_difference_country,
  type = "latex",
  title = "Textual Hiddenness and Difference by Country",
  dep.var.labels = c(
    "Textual Hiddenness",
    "Textual Difference"
  ),
  column.labels = c(
    "Hiddenness",
    "Difference"
  ),
  omit.stat = c("f", "ser"),
  digits = 3,
  align = TRUE,
  no.space = TRUE,
  notes = "Reference category for country indicators is \"EU\"."
)

```




